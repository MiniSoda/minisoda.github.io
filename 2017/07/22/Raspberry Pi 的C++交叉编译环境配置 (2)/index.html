<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Raspberry Pi 的C++交叉编译环境配置 (2) | MiniSoda 的博客</title>
  <meta name="author" content="George Zheng">

  
  <meta name="description" content="上一节我们把RPi的交叉编译器准备好了，但是实际上并没有配置好编译器所需要的库文件。
首先，我们做一些配置，让Ubuntu主机与树莓派通信更加方便。为了方便区分，每段代码的上方用host表示在Ubuntu中执行的命令raspberry表示在树莓派中执行的命令

添加树莓派的IP到主机的host文件中">
  
  

  <link rel="alternate" href="/atom.xml" title="MiniSoda 的博客" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8/jquery.min.js"></script>
  
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-103184815-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>

</head>

<body>
  <header id="header" class="inner"><nav>
  <ul>
    
      <li><a href="/">Home</a></li>
    
      <li><a href="/archives">Archives</a></li>
    
  </ul>
</nav></header>
  <div id="content" class="inner"><article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <header>
    
  
    <h1 class="title">Raspberry Pi 的C++交叉编译环境配置 (2)</h1>
  

    <time datetime="2017-07-22T14:17:33.000Z">
  <span class="day">22</span><span class="month">Jul</span>
</time>
  </header>
  <div class="entry-content">
    
      <p>上一节我们把RPi的交叉编译器准备好了，但是实际上并没有配置好编译器所需要的库文件。</p>
<p>首先，我们做一些配置，让Ubuntu主机与树莓派通信更加方便。为了方便区分，每段代码的上方用host表示在Ubuntu中执行的命令raspberry表示在树莓派中执行的命令</p>
<ol>
<li><p>添加树莓派的IP到主机的host文件中：</p>
<p><em>host</em></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">vi /etc/hosts</div></pre></td></tr></table></figure>
<p>移动光标到相应的地方按 <em>i</em> 进入编辑模式。添加主机的IP地址和名称，然后 <em>:wq</em> 保存</p>
<p><img src="/2017/07/22/Raspberry Pi 的C++交叉编译环境配置 (2)/add_host.jpg" alt="add_host"></p>
</li>
<li><p>添加公钥到RPi，这样以后对RPi的远程操作不需要重新输入密码了</p>
<p><em>host</em></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ssh-keygen -t rsa</div></pre></td></tr></table></figure>
<p>一路确认不要输入其他参数，成功后会在 <em>~/.ssh</em> 目录下生成公钥和私钥 <em>id_rsa id_rsa.pub</em></p>
<p>将公钥复制到RPi的 ~/.ssh目录下，以后通过Ubuntu主机就可以直接登录RPi不需要重复输入密码了。</p>
<p><em>raspberry</em></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">scp ~/.ssh/id_rsa.pub pi@raspberry:~/.ssh/id_rsa.pub</div></pre></td></tr></table></figure>
<p>然后登录到RPi 把id_rsa.pub的内容添加到authorized_keys文件中</p>
<p><em>raspberry</em></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">cd</span> .ssh</div><div class="line">cat id_rsa.pub&gt;&gt;authorized_keys</div></pre></td></tr></table></figure>
<p>回到Ubuntu主机的terminal中测试</p>
<p><em>host</em></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ssh pi@raspberry</div></pre></td></tr></table></figure>
<p>如果不需输入密码了说明配置成功了</p>
<p>​</p>
</li>
</ol>
<p>下一步，我们在Ubuntu上建立一个文件夹用来存放RPi的库和头文件。然后通过rsync命令把树莓派上面的文件拷贝到本地，注意在此之前要上一步的操作已经完成，否则请把rsync命令中的raspberry替换成实际的IP地址。</p>
<p><em>host</em></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">mkdir raspberrypi &amp;&amp; <span class="built_in">cd</span> raspberrypi</div><div class="line">mkdir rootfs &amp;&amp; <span class="built_in">cd</span> rootfs</div><div class="line">rsync -rl --delete-after --safe-links pi@raspberry:/&#123;lib,usr&#125; <span class="variable">$HOME</span>/raspberrypi/rootfs</div></pre></td></tr></table></figure>
<p>这里rsync会把RPi上整个 lib 和 usr目录拷贝过来，如果需要Qt库的话可以在拷贝之前先在RPi上配置好Qt开发所需的库然后再拷贝。</p>
<p>拷贝结束后我们写一个测试程序来试一试吧。</p>
<p>用编辑器输入以下代码，保存为 <em>test.cpp</em></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;string&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;thread&gt;</span></span></div><div class="line"></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">( <span class="keyword">int</span> argc, <span class="keyword">char</span>* argv[])</span></span></div><div class="line">&#123;</div><div class="line">    <span class="built_in">std</span>::<span class="function">thread <span class="title">t</span><span class="params">( []()</span></span>&#123; <span class="built_in">puts</span>(<span class="string">"Hello, Lambda thread!"</span>);  &#125;);  </div><div class="line">    <span class="built_in">string</span> strInfo = <span class="string">""</span>;</div><div class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"Hello Test!"</span>&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">    <span class="keyword">float</span> szChara = <span class="number">8.0</span>;</div><div class="line">    </div><div class="line">    <span class="keyword">int</span> sum=<span class="number">0</span>;</div><div class="line">    <span class="keyword">for</span>( <span class="keyword">int</span> i=<span class="number">0</span>; i&lt;<span class="number">10</span>;i++)</div><div class="line">    &#123;</div><div class="line">        sum+=i;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">int</span> size = <span class="keyword">sizeof</span>(szChara);</div><div class="line">    <span class="built_in">cout</span>&lt;&lt; <span class="string">"size of char: "</span>&lt;&lt; size &lt;&lt; <span class="built_in">endl</span>;</div><div class="line">    t.join();  </div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>在Terminal中用编译器编译一下</p>
<p><em>host</em></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">arm-linux-gnueabihf-g++ -Wall -pthread -std=c++11 -o testapp test.cpp -I~/raspberrypi/rootfs/usr/include -L~/raspberrypi/rootfs/lib/arm-linux-gnueabihf</div></pre></td></tr></table></figure>
<p>可以看到这时目录中生成了 testapp执行文件，如果此时执行这个文件会提示</p>
<p>bash: ./testapp: cannot execute binary file: Exec format error</p>
<p>这是因为用交叉编译工具编译出来的执行文件是以arm平台作为目标的，而我们的Ubuntu主机是X86架构。可以通过file命令来验证。</p>
<p><img src="/2017/07/22/Raspberry Pi 的C++交叉编译环境配置 (2)/compile_run.jpg" alt="compile_run"></p>
<p>现在我们把testapp传输到RPi上来执行</p>
<p><em>raspberry</em></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">scp testapp pi@raspberry:testapp</div></pre></td></tr></table></figure>
<p>切换到RPi的Terminal上来执行</p>
<p><em>raspberry</em></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">./testapp</div></pre></td></tr></table></figure>
<p>窗口输出</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">pi@raspberrypi:~ $ ./testapp </div><div class="line">Hello Test!</div><div class="line">size of char: 4</div><div class="line">Hello, Lambda thread!</div></pre></td></tr></table></figure>
<p>至此，我们对编译环境的配置就完全结束了，下一节我们开始配置VSCODE</p>

    
    
    <footer class="meta">
      
  <div class="cats">
<a href="/categories/技术类/">技术类</a></div>

      
  <div class="tags">
<a href="/tags/RPi/">RPi</a><a href="/tags/Ubuntu/">Ubuntu</a><a href="/tags/C/">C++</a><a href="/tags/VSCODE/">VSCODE</a></div>

      
    </footer>
    
  </div>
  
</article></div>
  <footer id="footer" class="inner"><div class="social alignright">
  
  
  
    <a class="twitter" href="http://twitter.com/https://twitter.com/PuffingWorks" title="Twitter">Twitter</a>
  
  
    <a class="github" href="https://github.com/https://github.com/MiniSoda" title="GitHub">GitHub</a>
  
  <a class="rss" href="/atom.xml" title="RSS">RSS</a>
</div>
<p>
  
  &copy; 2017 George Zheng
  
</p>
<div class="clearfix"></div></footer>
  <script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>




<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>


<div id="phasebeam">
  <canvas></canvas>
  <canvas></canvas>
  <canvas></canvas>
</div>
<script src="/js/phasebeam.js"></script>
</body>
</html>